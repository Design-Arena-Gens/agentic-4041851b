<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Hyperf Socket.IO Auto Validation Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: sans-serif; margin: 2rem; }
        #logs { border: 1px solid #ccc; padding: 1rem; height: 260px; overflow-y: auto; }
        form { margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        label { display: flex; flex-direction: column; font-size: 0.85rem; }
        input { padding: 0.5rem; font-size: 1rem; }
        button { padding: 0.6rem 1rem; font-size: 1rem; cursor: pointer; }
        .error { color: #b00020; }
    </style>
</head>
<body>
    <h1>Hyperf Socket.IO Auto Validation Demo</h1>
    <div>
        <label>
            Server URL
            <input id="server" value="http://localhost:9502" />
        </label>
        <button id="connect">Connect</button>
    </div>
    <div id="status">Disconnected</div>
    <div id="logs"></div>
    <form id="message-form">
        <label>Room <input id="room" value="general" required /></label>
        <label>Author <input id="author" value="anonymous" required /></label>
        <label style="flex:1 1 100%">Message <input id="message" placeholder="Say hello" required /></label>
        <button type="submit">Send</button>
    </form>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" integrity="sha384-zJ7R6pujISiFDUFxIr05oig3NbSsgCjYG4p1Tdk6oTR52C3FUcoXtL4RS5m2S6lM" crossorigin="anonymous"></script>
    <script>
        const statusEl = document.getElementById('status');
        const logsEl = document.getElementById('logs');
        const form = document.getElementById('message-form');
        const serverInput = document.getElementById('server');
        let socket;

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = message;
            if (type === 'error') div.classList.add('error');
            logsEl.appendChild(div);
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        document.getElementById('connect').addEventListener('click', () => {
            if (socket) {
                socket.disconnect();
            }
            log('Connecting...');
            socket = io(serverInput.value, { transports: ['websocket'] });
            socket.on('connect', () => {
                statusEl.textContent = 'Connected';
                log('Connected');
            });
            socket.on('connect_error', err => {
                statusEl.textContent = 'Connection error';
                log('Connection error: ' + err.message, 'error');
            });
            socket.on('system:welcome', payload => {
                log('System: ' + payload.message);
            });
            socket.on('message:received', payload => {
                log(`[${payload.room}] ${payload.author}: ${payload.message}`);
            });
            socket.on('validation:error', payload => {
                log('Validation failed: ' + JSON.stringify(payload.errors), 'error');
            });
            socket.on('disconnect', () => {
                statusEl.textContent = 'Disconnected';
                log('Disconnected');
            });
        });

        form.addEventListener('submit', evt => {
            evt.preventDefault();
            if (!socket || !socket.connected) {
                log('Socket not connected', 'error');
                return;
            }
            socket.emit('message:send', {
                room: document.getElementById('room').value,
                message: document.getElementById('message').value,
                author: document.getElementById('author').value,
            });
            document.getElementById('message').value = '';
        });
    </script>
</body>
</html>
